<!DOCTYPE html>
<html lang="ar" dir="rtl">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>إجراءات وخطوات مراجعة | Talal Cerity</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;700&display=swap" rel="stylesheet">
    <script>
        // إعداد الـ Worker لمكتبة PDF
        pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js';
    </script>

    <style>
         :root {
            --primary-color: #2c3e50;
            --accent-color: #3498db;
            --bg-color: #ecf0f1;
            --text-color: #2c3e50;
            --sidebar-width: 300px;
            --sidebar-shrink-width: 0px;
            /* للموبايل أو الانكماش الكامل */
            --header-height: 90px;
        }
        
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            user-select: none;
            /* منع تحديد النصوص */
            -webkit-user-select: none;
        }
        
        body {
            font-family: 'Tajawal', sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            overflow: hidden;
            /* التطبيق يملأ الشاشة */
            height: 100vh;
            display: flex;
            flex-direction: column;
        }
        /* --- Header Styles --- */
        
        header {
            height: var(--header-height);
            background: linear-gradient(135deg, #ffffff 0%, #f1f1f1 100%);
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 20px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            z-index: 10;
            position: relative;
        }
        
        .header-content {
            text-align: center;
        }
        
        h1 {
            font-size: 1.5rem;
            color: var(--primary-color);
            margin-bottom: 5px;
        }
        
        .subtitle {
            font-size: 0.8rem;
            color: #7f8c8d;
        }
        
        .logo-container {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            overflow: hidden;
            border: 3px solid var(--accent-color);
            box-shadow: 0 0 10px rgba(52, 152, 219, 0.5);
            transition: transform 0.3s;
            background: white;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        
        .logo-container:hover {
            transform: scale(1.05);
        }
        
        .logo-container img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        /* --- Main Layout --- */
        
        main {
            display: flex;
            flex: 1;
            height: calc(100vh - var(--header-height));
            transition: all 0.5s ease;
        }
        /* Sidebar (Right) */
        
        aside {
            width: var(--sidebar-width);
            background: white;
            border-left: 1px solid #ddd;
            overflow-y: auto;
            padding: 20px;
            transition: width 0.5s ease, padding 0.5s ease, opacity 0.3s;
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        /* Shrink State */
        
        main.shrunk aside {
            width: 0;
            padding: 0;
            opacity: 0;
            border: none;
        }
        /* Toggle Button for Sidebar (Visible when shrunk) */
        
        #toggle-sidebar {
            position: absolute;
            right: 0;
            top: 50%;
            background: var(--accent-color);
            color: white;
            padding: 10px;
            cursor: pointer;
            border-radius: 5px 0 0 5px;
            display: none;
            z-index: 20;
        }
        
        main.shrunk #toggle-sidebar {
            display: block;
        }
        /* Links Styles */
        
        .doc-link {
            display: block;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 8px;
            text-decoration: none;
            color: var(--primary-color);
            border-right: 4px solid var(--accent-color);
            transition: all 0.3s;
            cursor: pointer;
            font-weight: bold;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
        }
        
        .doc-link:hover {
            background: var(--accent-color);
            color: white;
            transform: translateX(-5px);
        }
        
        #viewer-container {
            flex: 1;
            background: #525659;
            /* PDF viewer background color */
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: flex-start;
            position: relative;
            overflow: hidden;
        }
        /* Toolbar */
        
        .toolbar {
            width: 100%;
            background: #333;
            color: white;
            padding: 10px;
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 15px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
        }
        
        .toolbar button {
            background: var(--accent-color);
            border: none;
            color: white;
            padding: 5px 15px;
            border-radius: 4px;
            cursor: pointer;
            font-family: inherit;
        }
        
        .toolbar button:disabled {
            background: #7f8c8d;
            cursor: not-allowed;
        }
        
        .page-input {
            width: 50px;
            padding: 5px;
            text-align: center;
            border-radius: 4px;
            border: none;
        }
        /* Canvas Wrapper for Flipbook feel */
        
        #canvas-wrapper {
            margin-top: 20px;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.5);
            max-height: 85vh;
            overflow: auto;
            background: white;
            transition: opacity 0.3s;
        }
        /* حاوية الكانفاس لتطبيق التأثير */
        /* حاوية العرض الرئيسية لضمان التوسيط */
        
        #the-canvas {
            box-shadow: -10px 0 20px rgba(0, 0, 0, 0.4);
            background: linear-gradient(to right, #ffffff 0%, #f9f9f9 2%, #ffffff 100%);
            border-left: 1px solid rgba(0, 0, 0, 0.1);
            transition: transform 0.4s ease-in-out, opacity 0.3s;
            will-change: transform;
        }
        /* Responsive Design */
        
        @media (max-width: 768px) {
            header {
                padding: 5px;
                height: auto;
                flex-wrap: wrap;
                justify-content: center;
                gap: 10px;
            }
            .logo-container {
                width: 50px;
                height: 50px;
            }
            h1 {
                font-size: 1.1rem;
            }
            main {
                flex-direction: column;
            }
            aside {
                width: 100%;
                height: auto;
                max-height: 40vh;
                border-left: none;
                border-bottom: 1px solid #ddd;
            }
            main.shrunk aside {
                height: 0;
                width: 100%;
            }
        }
    </style>
</head>

<body>

    <header>
        <div class="logo-container">
            <img src="https://talalcer.github.io/fuel-img/mizan.png" alt="Company Logo">
        </div>

        <div class="header-content">
            <h1>إجراءات وخطوات مراجعة</h1>
            <div class="subtitle">الحقوق محفوظة لاصحاب المقالات | Talal Cerity</div>
        </div>

        <div class="logo-container">
            <img src="https://talalcer.github.io/fuel-img/auditortool5.png" alt="Talal Cerity">
        </div>
    </header>

    <main id="main-layout">
        <div id="toggle-sidebar" onclick="app.ui.toggleLayout()">☰ القائمة</div>

        <aside id="links-sidebar">
        </aside>

        <section id="viewer-container">
            <div class="toolbar" id="toolbar" style="display:none;">
                <button onclick="app.viewer.nextPage()">&lt; التالي </button>
                <span>صفحة <input type="number" id="page_num" class="page-input" value="1"> من <span id="page_count">--</span></span>
                <button onclick="app.viewer.prevPage()">السابق &gt;</button>
            </div>

            <div id="canvas-wrapper">
                <canvas id="the-canvas"></canvas>
            </div>

            <div id="loading-msg" style="color:white; margin-top:50px;">اختر ملفاً للعرض...</div>
        </section>
    </main>

    <script>
        /**
         * Security Module
         * Disabling context menu and DevTools
         */
        (function secureApp() {
            document.addEventListener('contextmenu', event => event.preventDefault());
            document.addEventListener('keydown', function(e) {
                // Disable F12, Ctrl+Shift+I, Ctrl+Shift+J, Ctrl+U
                if (e.key === 'F12' ||
                    (e.ctrlKey && e.shiftKey && (e.key === 'I' || e.key === 'J')) ||
                    (e.ctrlKey && e.key === 'U')) {
                    e.preventDefault();
                }
            });
        })();

        /**
         * Class: Viewer
         * Handles PDF loading and rendering logic using OOP Encapsulation
         */
        class PDFViewer {
            constructor() {
                this.pdfDoc = null;
                this.pageNum = 1;
                this.pageRendering = false;
                this.scale = 1.3;
                this.canvas = document.getElementById('the-canvas');
                this.ctx = this.canvas.getContext('2d');

                document.getElementById('page_num').addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') {
                        let num = parseInt(e.target.value);
                        if (this.pdfDoc && num > 0 && num <= this.pdfDoc.numPages) {
                            this.pageNum = num; // تحديث الرقم الحالي فوراً
                            this.applyFlipEffect(() => this.renderPage(this.pageNum));
                        }
                    }
                });
            }

            applyFlipEffect(callback) {
                // تأثير الطي: دوران وتصغير بسيط
                this.canvas.style.transform = 'rotateY(-15deg) scale(0.98)';
                this.canvas.style.opacity = '0.7';

                setTimeout(() => {
                    callback();
                    this.canvas.style.transform = 'rotateY(0deg) scale(1)';
                    this.canvas.style.opacity = '1';
                }, 200);
            }

            async loadDocument(filename) {
                const url = `${window.Config.folder}/${filename}${window.Config.extension}`;
                document.getElementById('loading-msg').style.display = 'block';
                document.getElementById('loading-msg').innerText = 'جاري التحميل...';
                document.getElementById('toolbar').style.display = 'none';

                try {
                    const response = await fetch(url);
                    if (!response.ok) throw new Error('File not found');
                    const blob = await response.blob();
                    const objectUrl = URL.createObjectURL(blob);

                    const loadingTask = pdfjsLib.getDocument({
                        url: objectUrl,
                        disableFontFace: true
                    });

                    this.pdfDoc = await loadingTask.promise;
                    document.getElementById('page_count').textContent = this.pdfDoc.numPages;
                    document.getElementById('loading-msg').style.display = 'none';
                    document.getElementById('toolbar').style.display = 'flex';

                    this.pageNum = 1;
                    this.renderPage(this.pageNum);
                } catch (error) {
                    document.getElementById('loading-msg').innerText = 'خطأ في فتح الملف';
                }
            }

            renderPage(num) {
                this.pageRendering = true;
                this.pdfDoc.getPage(num).then((page) => {
                    const viewport = page.getViewport({
                        scale: this.scale
                    });
                    this.canvas.height = viewport.height;
                    this.canvas.width = viewport.width;

                    const renderContext = {
                        canvasContext: this.ctx,
                        viewport: viewport
                    };

                    page.render(renderContext).promise.then(() => {
                        this.pageRendering = false;
                        document.getElementById('page_num').value = num;
                    });
                });
            }

            // دوال الأزرار
            prevPage() {
                if (!this.pdfDoc || this.pageNum <= 1 || this.pageRendering) return;
                this.pageNum--;
                this.applyFlipEffect(() => this.renderPage(this.pageNum));
            }

            nextPage() {
                if (!this.pdfDoc || this.pageNum >= this.pdfDoc.numPages || this.pageRendering) return;
                this.pageNum++;
                this.applyFlipEffect(() => this.renderPage(this.pageNum));
            }
        }

        /**
         * Class: UIManager
         * Handles layout, sidebar generation, and interactions
         */
        class UIManager {
            constructor(viewerInstance) {
                    this.viewer = viewerInstance;
                    this.sidebar = document.getElementById('links-sidebar');
                    this.mainLayout = document.getElementById('main-layout');
                    //this.initLinks();
                    this.loadConfigAndInit();
                }
                // دالة جديدة لجلب البيانات من ملف JSON
            async loadConfigAndInit() {
                try {
                    const response = await fetch('https://talalcer.github.io/auditproclink.json'); // جلب الملف
                    if (!response.ok) throw new Error('تعذر تحميل ملف البيانات');

                    // تخزين البيانات في كائن Config عالمي لاستخدامه في أجزاء الكود الأخرى
                    window.Config = await response.json();

                    // بعد نجاح الجلب، نقوم ببناء القائمة
                    this.initLinks();
                } catch (error) {
                    console.error('Error loading config:', error);
                    this.sidebar.innerHTML = '<div style="color:red; padding:10px;">خطأ في تحميل قائمة الملفات</div>';
                }
            }


            // دالة تفعيل وضع ملء الشاشة (جديدة)
            enterFullscreen() {
                const rootElement = document.documentElement; // العنصر الذي سيتم عرضه بملء الشاشة
                if (rootElement.requestFullscreen) {
                    rootElement.requestFullscreen();
                } else if (rootElement.mozRequestFullScreen) { /* Firefox */
                    rootElement.mozRequestFullScreen();
                } else if (rootElement.webkitRequestFullscreen) { /* Chrome, Safari and Opera */
                    rootElement.webkitRequestFullscreen();
                } else if (rootElement.msRequestFullscreen) { /* IE/Edge */
                    rootElement.msRequestFullscreen();
                }
            }

            initLinks() {
                // إضافة العنوان المميز للقائمة
                const titleElement = document.createElement('div');
                titleElement.className = 'link-title';
                titleElement.innerText = 'ملفات الإجراءات المتاحة';
                this.sidebar.appendChild(titleElement);

                // بناء الروابط من البيانات التي جلبناها
                window.Config.links.forEach(link => {
                    const btn = document.createElement('div');
                    btn.className = 'doc-link';
                    btn.innerText = link.title;
                    btn.onclick = () => {
                        this.handleLinkClick(link.file, link.title);
                    };
                    this.sidebar.appendChild(btn);
                });
            }

            handleLinkClick(filename, title) {
                this.enterFullscreen();
                this.mainLayout.classList.add('shrunk');
                // استخدام window.Config الذي تم تعبئته من ملف JSON
                this.viewer.loadDocument(filename, title);
            }

            toggleLayout() {
                this.mainLayout.classList.toggle('shrunk');
            }
        }

        /**
         * Main App Initialization
         */
        const app = {
            viewer: new PDFViewer(),
            ui: null
        };

        // Initialize UI after viewer is ready
        window.addEventListener('DOMContentLoaded', () => {
            app.ui = new UIManager(app.viewer);
        });
    </script>
</body>

</html>
